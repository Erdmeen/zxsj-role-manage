<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>è¯›ä»™ä¸–ç•Œè§’è‰²å‘¨ä»»åŠ¡è®°å½•</title>
    <script src="./vue.global.js"></script>
    <style>
      /* åŸºç¡€æ ·å¼ */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      html,
      body {
        height: 100%;
        overflow: hidden;
      }

      body {
        color: rgba(0, 0, 0, 0.85);
        padding: 0;
        font-size: 14px;
        line-height: 1.5715;
        display: flex;
        flex-direction: column;
        overflow-x: auto;
      }

      .container {
        width: 100%;
        min-width: 1057px;
        margin: 0 auto;
        background-color: #fff;
        border-radius: 2px;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
        padding: 16px;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: auto;
        gap: 5px;
      }

      /* æŒ‰é’®ç»Ÿä¸€æ ·å¼ */
      .btn {
        height: 36px;
        padding: 6px 16px;
        border: 1px solid transparent;
        border-radius: 2px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.12);
        box-shadow: 0 2px 0 rgba(0, 0, 0, 0.045);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #1890ff;
        color: #fff;
        margin-right: 12px;
        min-width: 88px;
      }

      .btn:last-child {
        margin-right: 0;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* ç¼–è¾‘æŒ‰é’®æ ·å¼ */
      .btn-edit {
        background: #1890ff;
        border-color: #1890ff;
      }

      .btn-success {
        background: #52c41a;
        border-color: #52c41a;
      }

      .btn-danger {
        background: #ff4d4f;
        border-color: #ff4d4f;
      }

      /* å°å‹æŒ‰é’®æ ·å¼ */
      .category-header .btn-sm {
        padding: 4px 12px;
        font-size: 12px;
        border: 1px solid #1890ff;
        border-radius: 2px;
        background: #1890ff;
        cursor: pointer;
        transition: all 0.3s;
      }

      /* å¡ç‰‡å¸ƒå±€ä¼˜åŒ– */
      .module-container {
        border-radius: 2px;
        padding: 16px;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
        transition: all 0.3s;
        border: 1px solid #f0f0f0;
        background: #fff;
        margin-bottom: 0;
      }

      .module-container:hover {
        box-shadow: 0 3px 6px -4px rgba(0, 0, 0, 0.12),
          0 6px 16px 0 rgba(0, 0, 0, 0.08), 0 9px 28px 8px rgba(0, 0, 0, 0.05);
      }

      .role-list .module-title {
        font-size: 16px;
        color: rgba(0, 0, 0, 0.85);
        font-weight: 500;
        line-height: 24px;
        height: 24px;
      }

      .role-item {
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 2px;
        cursor: pointer;
        transition: all 0.3s;
        background-color: #fafafa;
        border: 1px solid #f0f0f0;
      }

      .role-item:last-child {
        margin-bottom: 0;
      }

      .role-item:hover {
        background-color: #f5f5f5;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
      }

      .role-item.active {
        background-color: #e6f7ff;
        border-color: #91d5ff;
      }

      .role-content {
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .role-content .module-container {
        margin-bottom: 20px;
        /* æ·»åŠ åº•éƒ¨é—´è· */
      }

      .role-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        border-bottom: 1px solid #f0f0f0;
        background-color: #fafafa;
      }

      .role-header-buttons {
        display: flex;
        gap: 8px;
      }

      .role-name-container {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: space-between;
      }

      .role-name {
        font-size: 14px;
        color: rgba(0, 0, 0, 0.85);
        margin: 0;
        line-height: 1.4;
        font-weight: 500;
      }

      .role-description {
        color: #666;
        font-size: 14px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: normal;
        word-wrap: break-word;
        word-break: break-all;
        max-width: 100%;
        width: 100%;
        margin-top: 4px;
        background-color: #f5f5f5;
        border-radius: 2px;
      }

      .profession-tag {
        padding: 2px 8px;
        font-size: 12px;
        border-radius: 2px;
        color: #fff;
        font-weight: 500;
        line-height: 1.4;
      }

      /* æ ‡ç­¾ç»Ÿä¸€æ ·å¼ */
      .profession-tag,
      .dungeon-tag,
      .dungeon-size,
      .task-type-tag {
        display: inline-flex;
        align-items: center;
        height: 24px;
        padding: 0 8px;
        font-size: 12px;
        line-height: 24px;
        border-radius: 2px;
        color: #fff;
        font-weight: 500;
        white-space: nowrap;
      }

      /* èŒä¸šæ ‡ç­¾æ ·å¼ */
      .profession-tag.ghost-king {
        background: #ff4d4f;
      }

      .profession-tag.spirit-tide {
        background: #52c41a;
      }

      .profession-tag.blue-cloud {
        background: #1890ff;
      }

      .profession-tag.harmony {
        background: #722ed1;
      }

      .profession-tag.incense {
        background: #fa8c16;
      }

      /* å‰¯æœ¬æ ‡ç­¾æ ·å¼ */
      .dungeon-tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 2px;
        font-size: 12px;
        margin-left: 8px;
        color: #fff;
        line-height: 1.5;
      }

      .dungeon-tag.hard {
        background-color: #1890ff;
      }

      .dungeon-tag.nightmare {
        background-color: #ff4d4f;
      }

      /* å‰¯æœ¬è§„æ¨¡æ ‡ç­¾æ ·å¼ */
      .dungeon-size.small {
        background: #52c41a;
      }

      .dungeon-size.medium {
        background: #1890ff;
      }

      .dungeon-size.large {
        background: #722ed1;
      }

      /* ä»»åŠ¡ç±»å‹æ ‡ç­¾æ ·å¼ */
      .task-type-tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 2px;
        font-size: 12px;
        line-height: 20px;
        color: #fff;
        margin-right: 8px;
      }

      /* å‰¯æœ¬ä»»åŠ¡ */
      .task-type-tag.dungeon {
        background-color: #ff4d4f;
      }

      /* å¸®æ´¾ä»»åŠ¡ */
      .task-type-tag.guild {
        background-color: #fa8c16;
      }

      /* ä¸–ç•Œä»»åŠ¡ */
      .task-type-tag.world {
        background-color: #efe409;
      }

      /* å…¶ä»–ä»»åŠ¡ */
      .task-type-tag.other {
        background-color: #52c41a;
      }

      /* æ´»åŠ›ä»»åŠ¡ */
      .task-type-tag.vitality {
        background-color: #00c1ab;
      }

      /* æ´»åŠ¨ä»»åŠ¡ */
      .task-type-tag.activity {
        background-color: #1890ff;
      }

      /* è‡ªå®šä¹‰ä»»åŠ¡ */
      .task-type-tag.custom {
        background-color: #722ed1;
      }

      

      .task-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        margin-bottom: 8px;
        background: #fff;
        border: 1px solid #f0f0f0;
        border-radius: 2px;
        transition: all 0.3s;
        min-height: 40px;
        width: 100%;
      }

      .task-item:last-child {
        margin-bottom: 0;
      }

      .task-item:hover {
        background: #fafafa;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
      }

      .task-item.completed {
        background: #f6ffed;
        border-color: #b7eb8f;
        opacity: 0.8;
      }

      .task-checkbox {
        margin-right: 12px;
        width: 16px;
        height: 16px;
        cursor: pointer;
      }

      .task-content {
        display: flex;
        align-items: center;
        flex: 1;
        min-width: 0;
        margin-right: 8px;
        overflow: hidden;
      }

      .task-name {
        margin: 0 8px;
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .task-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .task-item:hover .task-actions {
        opacity: 1;
      }

      .task-actions .btn {
        height: 28px;
        min-width: 60px;
        padding: 0 12px;
        font-size: 12px;
      }

      /* ç©ºçŠ¶æ€æ ·å¼ */
      .empty-state {
        text-align: center;
        padding: 32px 0;
        color: rgba(0, 0, 0, 0.25);
        background: #fafafa;
        border-radius: 2px;
        border: 1px dashed #f0f0f0;
      }

      /* ç§»åŠ¨ç«¯å¯¼èˆªæŒ‰é’® */
      .mobile-nav-toggle {
        display: none;
        width: 100%;
        height: 40px;
        padding: 0 16px;
        background: #fff;
        color: #1890ff;
        border: 1px solid #1890ff;
        border-radius: 2px;
        margin-bottom: 16px;
        font-weight: 400;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
      }

      .mobile-nav-toggle:hover {
        color: #40a9ff;
        border-color: #40a9ff;
        background: #fff;
      }

      /* é“¶ä¸¤æ˜¾ç¤ºæ ·å¼ä¼˜åŒ– */
      .silver-display {
        display: flex;
        align-items: center;
        height: 36px;
        padding: 0;
      }

      .silver-left {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .silver-icon {
        color: #faad14;
        font-size: 14px;
      }

      .silver-amount {
        color: #faad14;
        font-weight: 500;
        font-size: 14px;
      }

      .silver-unit {
        font-size: 12px;
        color: rgba(0, 0, 0, 0.45);
        margin-left: 2px;
      }

      /* é“¶ä¸¤ç¼–è¾‘å®¹å™¨æ ·å¼ */
      .silver-edit-container {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .silver-edit-input {
        width: 80px;
        height: 32px;
        padding: 4px 8px;
        border: 1px solid #d9d9d9;
        border-radius: 2px;
        font-size: 14px;
      }

      /* è§’è‰²åˆ—è¡¨ä¸­çš„é“¶ä¸¤æ˜¾ç¤º */
      .role-item .silver-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 24px;
      }

      .role-item .silver-icon {
        font-size: 14px;
      }

      .role-item .silver-amount {
        color: #faad14;
        font-weight: 500;
        font-size: 14px;
      }

      .role-item .silver-unit {
        font-size: 12px;
        color: rgba(0, 0, 0, 0.45);
        margin-left: 2px;
      }

      .role-item .silver-right {
        display: flex;
        align-items: center;
      }

      /* è¿›åº¦æ¡æ ·å¼ä¼˜åŒ– */
      .role-progress-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 24px;
      }

      .role-progress-bar {
        flex: 1;
        height: 6px;
        background-color: #f0f0f0;
        border-radius: 2px;
        overflow: hidden;
        position: relative;
      }

      .progress-value {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: linear-gradient(90deg, #1890ff 0%, #40a9ff 100%);
        box-shadow: 0 0 10px rgba(24, 144, 255, 0.8);
        border-radius: 2px;
        transition: width 0.3s ease;
      }

      .progress-value.completed {
        background-color: #52c41a;
        /* ä½¿ç”¨ç»¿è‰²è¡¨ç¤ºå®Œæˆ */
        box-shadow: 0 0 8px rgba(82, 196, 26, 0.5);
        /* æ·»åŠ å‘å…‰æ•ˆæœ */
      }

      .role-progress-value {
        font-size: 12px;
        color: #1890ff;
        font-weight: 500;
        min-width: 40px;
        text-align: right;
      }

      .role-progress-value.completed-text {
        color: #52c41a;
        font-weight: 600;
      }

      /* æ ‡é¢˜å®¹å™¨æ ·å¼ */
      .title-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .title-left {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .title-left h1 {
        font-size: 24px;
        margin: 0;
        color: rgba(0, 0, 0, 0.85);
        font-weight: 600;
        line-height: 1.4;
      }

      .title-left p {
        margin: 0;
        font-size: 13px;
        color: rgba(0, 0, 0, 0.45);
        line-height: 1.6;
        max-width: 580px;
      }

      .title-right {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .btn-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      .btn-group .btn {
        margin: 0;
      }

      .reset-info {
        font-size: 13px;
        color: rgba(0, 0, 0, 0.65);
        line-height: 1.4;
      }

      .reset-info p {
        margin: 0;
      }

      .reset-time {
        color: #1890ff;
        font-weight: 500;
      }

      .reset-days {
        color: #ff4d4f;
        font-weight: 500;
      }

      /* èŒä¸šé€‰æ‹©æ ·å¼ */
      .profession-selection {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 8px 0;
      }

      .profession-option {
        cursor: pointer;
        padding: 4px;
        border-radius: 2px;
        transition: all 0.3s;
        position: relative;
      }

      .profession-option:hover {
        transform: translateY(-2px);
      }

      .profession-option.selected {
        background: rgba(24, 144, 255, 0.1);
      }

      .profession-option.selected::after {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        border: 2px solid #1890ff;
        border-radius: 2px;
        pointer-events: none;
      }

      .profession-option.selected .profession-tag {
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .profession-option:hover .profession-tag {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
      }

      .form-control-wrapper {
        position: relative;
      }

      .form-control {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #d9d9d9;
        border-radius: 2px;
        font-size: 14px;
        line-height: 1.5;
        transition: all 0.3s;
        height: 32px;
        box-sizing: border-box;
      }

      .form-control:hover {
        border-color: #40a9ff;
      }

      .form-control:focus {
        border-color: #40a9ff;
        outline: none;
        box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
      }

      textarea.form-control {
        resize: vertical;
        min-height: 100px;
        height: auto;
      }

      .form-actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        margin-top: 16px;
      }

      /* è§’è‰²è¡¨å•å·¦å³å¸ƒå±€æ ·å¼ */
      .role-form-container {
        display: flex;
        gap: 20px;
      }

      .role-form-left {
        flex: 1;
      }

      .role-form-right {
        display: none;
        flex: 1;
      }

      /* è¡¨å•æ ‡ç­¾å’Œè¾“å…¥æ¡†å·¦å³å¸ƒå±€ */
      .form-group-horizontal {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
      }

      .form-group-horizontal label {
        width: 100px;
        flex-shrink: 0;
        margin-bottom: 0;
        margin-right: 16px;
        line-height: 32px;
      }

      .form-group-horizontal .form-control-wrapper {
        flex: 1;
      }

      .role-info-container {
        flex: 1;
      }

      .role-name-description {
        flex: 2;
        text-align: right;
        padding-right: 20px;
      }

      /* è¡¨å•å¤´éƒ¨æ ·å¼ */
      .role-form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .role-form-header .form-buttons {
        margin-top: 0;
      }

      /* æ ‡é¢˜ç»Ÿä¸€æ ·å¼ */
      h1,
      h2,
      h3,
      h4 {
        margin: 0;
        padding: 0;
        font-weight: 500;
        color: rgba(0, 0, 0, 0.85);
      }

      h1 {
        font-size: 20px;
        line-height: 28px;
      }

      h2 {
        font-size: 18px;
        line-height: 26px;
      }

      h3 {
        font-size: 16px;
        line-height: 24px;
      }

      h4 {
        font-size: 14px;
        line-height: 22px;
      }

      .module-title {
        font-size: 16px;
        line-height: 36px;
        color: rgba(0, 0, 0, 0.85);
        font-weight: 500;
        height: 36px;
      }

      .category-header h4.module-title {
        margin-bottom: 10px;
      }

      /* ä»»åŠ¡ç±»åˆ«æ ·å¼ */
      .task-categories {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .task-category {
        min-width: 240px;
        max-width: 240px;
        flex: 1 0 240px;
        padding: 10px;
        background: #fff;
        border: 1px solid #f0f0f0;
        border-radius: 2px;
        display: flex;
        flex-direction: column;
      }

      .category-items {
        max-height: 180px;
        min-height: 180px;
        overflow-y: auto;
        border-radius: 2px;
        flex: 1;
      }

      /* æ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
      .task-categories::-webkit-scrollbar {
        height: 6px;
      }

      .task-categories::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 2px;
      }

      .task-categories::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 2px;
      }

      .task-categories::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .category-header .btn-sm {
        padding: 4px 12px;
        font-size: 12px;
        border: 1px solid #d9d9d9;
        border-radius: 2px;
        background: #fff;
        cursor: pointer;
        transition: all 0.3s;
      }

      /* å‰¯æœ¬ä»»åŠ¡æ ·å¼ */
      .dungeon-group {
        background: #fff;
        border: 1px solid #f0f0f0;
        border-radius: 2px;
        padding: 12px;
      }

      .dungeon-group:last-child {
        margin-bottom: 0;
      }

      .dungeon-group-header {
        padding-bottom: 8px;
      }

      .dungeon-task-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .dungeon-task-item {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        background: #fff;
        border: 1px solid #f0f0f0;
        border-radius: 2px;
        transition: all 0.3s;
        cursor: pointer;
      }

      .dungeon-task-item:hover {
        background: #f5f5f5;
      }

      .dungeon-task-item input[type="checkbox"] {
        margin-right: 12px;
      }

      .dungeon-task-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex: 1;
      }

      .dungeon-task-content span:first-child {
        color: rgba(0, 0, 0, 0.85);
        font-size: 14px;
      }

      /* é¢„å®šä¹‰ä»»åŠ¡é¡¹æ ·å¼ */
      .predefined-task-item {
        display: flex;
        align-items: center;
        height: 40px;
        padding: 0 12px;
        margin-bottom: 8px;
        background: #fff;
        border: 1px solid #f0f0f0;
        border-radius: 2px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .predefined-task-item:last-child {
        margin-bottom: 0;
      }

      .predefined-task-item:hover {
        background: #f5f5f5;
        border-color: #d9d9d9;
      }

      .predefined-task-item input[type="checkbox"] {
        margin-right: 12px;
      }

      /* æ»šåŠ¨æ¡æ ·å¼ */
      .category-items::-webkit-scrollbar {
        width: 6px;
      }

      .category-items::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 2px;
      }

      .category-items::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 2px;
      }

      .category-items::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* è§’è‰²åŒºåŸŸå¸ƒå±€æ ·å¼ */
      .role-section {
        display: flex;
        gap: 5px;
        height: calc(100vh - 100px);
        overflow: hidden;
      }

      .role-list.module-container {
        width: 300px;
        height: 100%;
        overflow-y: auto;
        flex-shrink: 0;
      }

      .role-content {
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .role-content .module-container {
        margin-bottom: 0;
      }

      .role-header.module-container {
        flex-shrink: 0;
      }

      .task-list.module-container {
        flex: 1;
        overflow-y: auto;
        display: block;
        /* ä¿®æ”¹è¿™é‡Œï¼Œé»˜è®¤æ˜¾ç¤º */
        margin-bottom: 0;
      }

      /* å½“æ˜¾ç¤ºè¡¨å•æ—¶éšè—ä»»åŠ¡åˆ—è¡¨ */
      .show-task-form .task-list.module-container {
        display: none;
      }

      .task-list .task-item {
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .task-list .task-item:hover {
        background-color: rgba(0, 0, 0, 0.05);
        transform: translateX(5px);
      }

      .task-list .task-item:active {
        background-color: rgba(0, 0, 0, 0.1);
        transform: translateX(3px);
      }

      .task-list .task-item:last-child {
        margin-bottom: 0;
      }

      .task-form-module {
        flex: 1;
        overflow-y: auto;
        display: block;
        margin-bottom: 0;
      }

      /* å½“æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨æ—¶ */
      .show-task-list .task-list.module-container {
        display: block;
      }

      /* å½“æ˜¾ç¤ºè¡¨å•æ—¶ */
      .show-task-form .task-form-module {
        display: block;
      }

      .show-task-form .task-list.module-container {
        display: none;
      }

      .empty-state.module-container {
        flex-shrink: 0;
      }

      .fixed-tasks .task-categories {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }

      .fixed-tasks .task-category {
        margin-bottom: 0;
      }

      .fixed-tasks .category-items {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }

      /* å…¶ä»–ä»»åŠ¡ä¿æŒåŸæœ‰å¸ƒå±€ */
      .custom-tasks .task-categories {
        display: block;
      }

      .custom-tasks .task-category {
        margin-bottom: 16px;
      }

      .silver-summary {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px;
        background: #f5f5f5;
        border-radius: 4px;
        margin-bottom: 10px;
        color: #666;
      }

      .silver-amount-total {
        font-weight: 500;
        color: #ff4d4f;
        font-size: 16px;
      }

      .silver-icon {
        display: flex;
        align-items: center;
        gap: 4px;
        color: #666;
        padding-right: 10px;
      }

      .role-info-right {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex-shrink: 0;
        padding-left: 20px;
      }

      .role-info-left {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .role-info-left .role-name-container {
        min-height: 36px;
        height: auto;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .role-header-buttons {
        display: flex;
        gap: 8px;
      }

      .role-task-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      .module-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .module-header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .module-header-right {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* å…è®¸è¾“å…¥æ¡†å’Œæ–‡æœ¬åŸŸå¯ä»¥å¤åˆ¶ */
      input, textarea {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }

      /* ç™»å½•å¯¹è¯æ¡†æ ·å¼ */
      .login-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .login-container {
        background: white;
        padding: 24px;
        border-radius: 4px;
        width: 100%;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .login-header {
        margin-bottom: 24px;
        text-align: center;
      }

      .login-header h2 {
        font-size: 24px;
        color: rgba(0, 0, 0, 0.85);
      }

      .login-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .login-form-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .login-form-item label {
        font-size: 14px;
        color: rgba(0, 0, 0, 0.85);
      }

      .login-form-item input {
        height: 40px;
        padding: 8px 12px;
        border: 1px solid #d9d9d9;
        border-radius: 2px;
        font-size: 14px;
        transition: all 0.3s;
      }

      .login-form-item input:focus {
        border-color: #40a9ff;
        box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        outline: none;
      }

      .login-form-actions {
        display: flex;
        justify-content: space-between;
        gap: 16px;
        margin-top: 24px;
      }

      .login-form-actions button {
        flex: 1;
      }
    </style>
    <script>
      // ç¦æ­¢å³é”®èœå•
      document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
      });

      // ç¦æ­¢é”®ç›˜å¿«æ·é”®
      document.addEventListener('keydown', function(e) {
        // ç¦æ­¢ Ctrl+C, Ctrl+V, Ctrl+X
        if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'x')) {
          e.preventDefault();
        }
      });
    </script>
  </head>

  <body>
    <div id="app" class="container">
      <!-- ç™»å½•å¯¹è¯æ¡† -->
      <div class="login-modal" v-if="showLoginModal">
        <div class="login-container">
          <div class="login-header">
            <h2>ç™»å½•</h2>
          </div>
          <div class="login-form">
            <div class="login-form-item">
              <label for="username">ç”¨æˆ·å</label>
              <input
                type="text"
                id="username"
                v-model="loginForm.username"
                placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                @keyup.enter="handleLogin"
              />
            </div>
            <div class="login-form-item">
              <label for="password">å¯†ç </label>
              <input
                type="password"
                id="password"
                v-model="loginForm.password"
                placeholder="è¯·è¾“å…¥å¯†ç "
                @keyup.enter="handleLogin"
              />
            </div>
            <div class="login-form-actions">
              <button class="btn btn-danger" @click="showLoginModal = false">å–æ¶ˆ</button>
              <button class="btn" @click="handleLogin">ç™»å½•</button>
            </div>
          </div>
        </div>
      </div>
      <div class="title-container module-container">
        <div class="title-left">
          <h1>è¯›ä»™ä¸–ç•Œè§’è‰²å‘¨ä»»åŠ¡è®°å½•</h1>
          <p>
            è¯´æ˜ï¼šæ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¯·è‡ªè¡Œå¯¼å‡ºå¤‡ä»½ã€‚
          </p>
        </div>
        <div class="title-right">
          <div class="reset-info">
            <p>
              ä¸‹æ¬¡é‡ç½®æ—¶é—´ï¼š<span class="reset-time">{{ nextResetDate }}</span>
            </p>
            <p>
              è·ç¦»é‡ç½®è¿˜æœ‰ï¼š<span class="reset-days">{{ daysUntilReset }}å¤©</span>
            </p>
          </div>
          <div class="btn-group">
            <button class="btn" @click="login" v-if="!isLoggedIn">ç™»å½•åŒæ­¥</button>
            <!-- <button class="btn btn-danger" @click="logout" v-if="isLoggedIn">é€€å‡ºç™»å½•</button> -->
            <button class="btn" @click="openAddRoleForm" v-if="!showAddRoleForm">
              æ·»åŠ è§’è‰²
            </button>
            <button class="btn btn-danger" @click="cancelAddRoleForm" v-if="showAddRoleForm">
              å–æ¶ˆæ·»åŠ 
            </button>
          </div>
          <div class="btn-group">
            <button class="btn" @click="exportData">å¯¼å‡ºæ•°æ®</button>
            <button class="btn" @click="importData">å¯¼å…¥æ•°æ®</button>
          </div>
        </div>
      </div>

      <div
        v-if="showAddRoleForm"
        class="form-group module-container role-module"
      >
        <h3>æ·»åŠ æ–°è§’è‰²</h3>
        <div class="role-form-container">
          <div class="role-form-left">
            <div class="form-group-horizontal">
              <label for="roleName">è§’è‰²åç§°</label>
              <div class="form-control-wrapper">
                <input
                  type="text"
                  id="roleName"
                  class="form-control"
                  v-model="newRole.name"
                  placeholder="è¯·è¾“å…¥è§’è‰²åç§°"
                />
              </div>
            </div>
            <div class="form-group">
              <label>é€‰æ‹©èŒä¸š</label>
              <div class="profession-selection">
                <div
                  v-for="prof in professions"
                  :key="prof.value"
                  class="profession-option"
                  :class="{ selected: newRole.profession === prof.value }"
                  @click="newRole.profession = prof.value"
                >
                  <span
                    class="profession-tag"
                    :class="getProfessionClass(prof.value)"
                    >{{ prof.value }}</span
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="role-form-right">
            <div class="form-group-horizontal">
              <label for="roleDescription">è§’è‰²æè¿°</label>
              <div class="form-control-wrapper">
                <textarea
                  id="roleDescription"
                  class="form-control"
                  v-model="newRole.description"
                  placeholder="è¯·è¾“å…¥è§’è‰²æè¿° (å¯é€‰)"
                  style="height: 100px"
                ></textarea>
              </div>
            </div>
          </div>
        </div>
        <div class="form-group form-buttons">
          <button class="btn" @click="addRole">ä¿å­˜è§’è‰²</button>
        </div>
      </div>

      <div class="role-section" v-if="roles.length > 0">
        <div
          class="role-list module-container role-module"
        >
          <div class="module-header">
            <h3 class="module-title">è§’è‰²åˆ—è¡¨</h3>
          </div>
          <div class="silver-summary" v-if="roles.length > 0">
            <span class="silver-icon">ğŸ’°æ€»èµ„äº§</span>
            <div class="silver-amount-total">
              {{ calculateTotalSilver() }}ä¸‡ä¸¤
            </div>
          </div>
          <div
            v-for="(role, index) in roles"
            :key="role.id"
            class="role-item"
            :class="{ active: currentRoleIndex === index }"
            @click="selectRole(index)"
          >
            <div class="role-name-container">
              <h2
                class="module-title"
              >
                {{ role.name }}
              </h2>
              <span
                v-if="role.profession"
                class="profession-tag"
                :class="getProfessionClass(role.profession)"
              >
                {{ role.profession }}
              </span>
            </div>
            <div v-if="role.silver > 0" class="silver-display">
              <span class="silver-icon">ğŸ’°</span>
              <div class="silver-right">
                <span class="silver-amount">{{ role.silver }}</span>
                <span class="silver-unit">ä¸‡ä¸¤</span>
              </div>
            </div>
            <div class="role-progress-container">
              <div class="progress-bar role-progress-bar">
                <div
                  class="progress-value"
                  :class="{ 'completed': calculateProgress(role) === 100 }"
                  :style="{ width: calculateProgress(role) + '%' }"
                ></div>
              </div>
              <span
                class="role-progress-value"
                :class="{ 'completed-text': calculateProgress(role) === 100 }"
              >
                {{ calculateProgress(role) }}%
              </span>
            </div>
          </div>
        </div>

        <div
          class="role-content"
          :class="{ 'show-task-form': showAddTaskForm }"
          v-if="currentRole"
        >
          <div class="role-header module-container header-module">
            <div class="role-info-left">
              <div class="role-name-container">
                <h2
                  class="module-title"
                >
                  {{ currentRole.name }}
                </h2>
                <span
                  v-if="currentRole.profession"
                  class="profession-tag"
                  :class="getProfessionClass(currentRole.profession)"
                >
                  {{ currentRole.profession }}
                </span>
                <!-- <div
                  v-if="currentRole.description && currentRole.description.trim()"
                  class="role-description"
                  style="flex-basis: 100%;"
                >
                  {{ currentRole.description }}
                </div> -->
              </div>

              <div class="silver-display">
                <div class="silver-left">
                  <span class="silver-icon">ğŸ’°èƒŒåŒ…é“¶ä¸¤</span>
                  <div class="silver-edit-container">
                    <input
                      type="number"
                      class="silver-edit-input"
                      v-model="silverEditValue"
                      min="0"
                      step="1"
                      @keyup.enter="updateSilver"
                    />
                    <span class="silver-unit">ä¸‡ä¸¤</span>
                    <button class="btn" @click="updateSilver">æ›´æ–°</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="role-info-right">
              <div class="role-header-buttons">
                <button v-if="!showEditRoleForm" class="btn btn-edit" @click="editRole">ç¼–è¾‘è§’è‰²</button>
                <button v-else class="btn btn-danger" @click="cancelEditRole">å–æ¶ˆç¼–è¾‘</button>
                <button class="btn btn-danger" @click="deleteRole">
                  åˆ é™¤è§’è‰²
                </button>
              </div>
            </div>
          </div>

          <div
            v-if="showEditRoleForm"
            class="form-group module-container role-module"
          >
            <h3 class="module-title">ç¼–è¾‘è§’è‰²</h3>
            <div class="role-form-container">
              <div class="role-form-left">
                <div class="form-group-horizontal">
                  <label for="editRoleName">è§’è‰²åç§°</label>
                  <div class="form-control-wrapper">
                    <input
                      type="text"
                      id="editRoleName"
                      class="form-control"
                      v-model="editingRole.name"
                      placeholder="è¯·è¾“å…¥è§’è‰²åç§°"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label>é€‰æ‹©èŒä¸š</label>
                  <div class="profession-selection">
                    <div
                      v-for="prof in professions"
                      :key="prof.value"
                      class="profession-option"
                      :class="{ selected: editingRole.profession === prof.value }"
                      @click="editingRole.profession = prof.value"
                    >
                      <span
                        class="profession-tag"
                        :class="getProfessionClass(prof.value)"
                        >{{ prof.value }}</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div class="role-form-right">
                <div class="form-group-horizontal">
                  <label for="editRoleDescription">è§’è‰²æè¿°</label>
                  <div class="form-control-wrapper">
                    <textarea
                      id="editRoleDescription"
                      class="form-control"
                      v-model="editingRole.description"
                      placeholder="è¯·è¾“å…¥è§’è‰²æè¿° (å¯é€‰)"
                      style="height: 100px"
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group form-buttons">
              <button class="btn btn-success" @click="saveEditedRole">
                ä¿å­˜ä¿®æ”¹
              </button>
            </div>
          </div>

          <div
            v-if="showAddTaskForm"
            class="form-group module-container task-form-module"
          >
            <div class="module-header">
              <div class="module-header-left">
                <h3 class="module-title">
                  {{ currentRole.tasks.length === 0 ? 'æ·»åŠ ä»»åŠ¡' : 'ç¼–è¾‘ä»»åŠ¡' }}
                </h3>
              </div>
              <div class="module-header-right">
                <button class="btn btn-danger" @click="showAddTaskForm = false">
                  å–æ¶ˆ
                </button>
              </div>
            </div>

            <!-- å›ºå®šä»»åŠ¡éƒ¨åˆ† -->
            <div
              class="form-group"
              v-if="!isEditingTask || (isEditingTask && newTask.category === 'custom')"
            >
              <div class="module-container category-module">
                <div class="module-header">
                  <div class="module-header-left">
                    <h4 class="module-title">å›ºå®šä»»åŠ¡</h4>
                  </div>
                  <div class="module-header-right">
                    <button class="btn" @click="addSelectedTasks">
                      æ·»åŠ å›ºå®šä»»åŠ¡
                    </button>
                  </div>
                </div>

                <div class="task-categories">
                  <div class="task-category module-container category-module">
                    <div class="category-header">
                      <h4 class="module-title">å‰¯æœ¬</h4>
                      <button
                        class="btn-sm"
                        @click="selectAllInCategory('dungeon')"
                      >
                        å…¨é€‰
                      </button>
                    </div>
                    <div class="category-items">
                      <!-- ä¼˜åŒ–åçš„å‰¯æœ¬æ˜¾ç¤ºæ–¹å¼ -->
                      <div class="dungeon-group">
                        <div class="dungeon-group-header">
                          <span class="dungeon-size small">5äººå‰¯æœ¬</span>
                        </div>
                        <div class="dungeon-task-container">
                          <div
                            v-for="(task, index) in getDungeonsBySize(5)"
                            :key="'dungeon-5-'+index"
                            class="dungeon-task-item"
                            @click="task.selected = !task.selected"
                          >
                            <input
                              type="checkbox"
                              :id="'dungeon-5-'+index"
                              v-model="task.selected"
                              @click.stop
                            />
                            <div class="dungeon-task-content">
                              <span>{{ task.name }}</span>
                              <span class="dungeon-tag" :class="task.difficulty"
                                >{{ getDifficultyText(task.difficulty) }}</span
                              >
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="dungeon-group">
                        <div class="dungeon-group-header">
                          <span class="dungeon-size medium">10äººå‰¯æœ¬</span>
                        </div>
                        <div class="dungeon-task-container">
                          <div
                            v-for="(task, index) in getDungeonsBySize(10)"
                            :key="'dungeon-10-'+index"
                            class="dungeon-task-item"
                            @click="task.selected = !task.selected"
                          >
                            <input
                              type="checkbox"
                              :id="'dungeon-10-'+index"
                              v-model="task.selected"
                              @click.stop
                            />
                            <div class="dungeon-task-content">
                              <span>{{ task.name }}</span>
                              <span class="dungeon-tag" :class="task.difficulty"
                                >{{ getDifficultyText(task.difficulty) }}</span
                              >
                            </div>
                          </div>
                        </div>
                      </div>

                      <div
                        class="dungeon-group"
                        v-if="getDungeonsBySize(20).length > 0"
                      >
                        <div class="dungeon-group-header">
                          <span class="dungeon-size large">20äººå‰¯æœ¬</span>
                        </div>
                        <div class="dungeon-task-container">
                          <div
                            v-for="(task, index) in getDungeonsBySize(20)"
                            :key="'dungeon-20-'+index"
                            class="dungeon-task-item"
                            @click="task.selected = !task.selected"
                          >
                            <input
                              type="checkbox"
                              :id="'dungeon-20-'+index"
                              v-model="task.selected"
                              @click.stop
                            />
                            <div class="dungeon-task-content">
                              <span>{{ task.name }}</span>
                              <span class="dungeon-tag" :class="task.difficulty"
                                >{{ getDifficultyText(task.difficulty) }}</span
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="task-category module-container category-module">
                    <div class="category-header">
                      <h4 class="module-title">å¸®æ´¾</h4>
                      <button
                        class="btn-sm"
                        @click="selectAllInCategory('guild')"
                      >
                        å…¨é€‰
                      </button>
                    </div>
                    <div class="category-items">
                      <div
                        v-for="(task, index) in predefinedTasks.guild"
                        :key="'guild-'+index"
                        class="dungeon-task-item"
                        @click="task.selected = !task.selected"
                      >
                        <input
                          type="checkbox"
                          :id="'guild-'+index"
                          v-model="task.selected"
                          @click.stop
                        />
                        <div class="dungeon-task-content">
                          <span>{{ task.name }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="task-category module-container category-module">
                    <div class="category-header">
                      <h4 class="module-title">ä¸–ç•Œ</h4>
                      <button
                        class="btn-sm"
                        @click="selectAllInCategory('world')"
                      >
                        å…¨é€‰
                      </button>
                    </div>
                    <div class="category-items">
                      <div
                        v-for="(task, index) in predefinedTasks.world"
                        :key="'world-'+index"
                        class="dungeon-task-item"
                        @click="task.selected = !task.selected"
                      >
                        <input
                          type="checkbox"
                          :id="'world-'+index"
                          v-model="task.selected"
                          @click.stop
                        />
                        <div class="dungeon-task-content">
                          <span>{{ task.name }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="task-category module-container category-module">
                    <div class="category-header">
                      <h4 class="module-title">å…¶ä»–</h4>
                      <button
                        class="btn-sm"
                        @click="selectAllInCategory('other')"
                      >
                        å…¨é€‰
                      </button>
                    </div>
                    <div class="category-items">
                      <div
                        v-for="(task, index) in predefinedTasks.other"
                        :key="'other-'+index"
                        class="dungeon-task-item"
                        @click="task.selected = !task.selected"
                      >
                        <input
                          type="checkbox"
                          :id="'other-'+index"
                          v-model="task.selected"
                          @click.stop
                        />
                        <div class="dungeon-task-content">
                          <span>{{ task.name }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="task-category module-container category-module">
                    <div class="category-header">
                      <h4 class="module-title">æ´»åŠ›</h4>
                      <button
                        class="btn-sm"
                        @click="selectAllInCategory('vitality')"
                      >
                        å…¨é€‰
                      </button>
                    </div>
                    <div class="category-items">
                      <div
                        v-for="(task, index) in predefinedTasks.vitality"
                        :key="'vitality-'+index"
                        class="dungeon-task-item"
                        @click="task.selected = !task.selected"
                      >
                        <input
                          type="checkbox"
                          :id="'vitality-'+index"
                          v-model="task.selected"
                          @click.stop
                        />
                        <div class="dungeon-task-content">
                          <span>{{ task.name }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="task-category module-container category-module">
                    <div class="category-header">
                      <h4 class="module-title">é™æ—¶</h4>
                      <button class="btn-sm" @click="selectAllInCategory('activity')">å…¨é€‰</button>
                    </div>
                    <div class="category-items">
                      <div v-for="(task, index) in predefinedTasks.activity" :key="'activity-'+index" class="dungeon-task-item" @click="task.selected = !task.selected">
                        <input type="checkbox" :id="'activity-'+index" v-model="task.selected" @click.stop />
                        <div class="dungeon-task-content">
                          <span>{{ task.name }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <!-- è‡ªå®šä¹‰ä»»åŠ¡éƒ¨åˆ† -->
            <div class="form-group module-container category-module">
              <div class="module-header">
                <div class="module-header-left">  
                  <h4 class="module-title">è‡ªå®šä¹‰ä»»åŠ¡</h4>
                </div>
                <div class="module-header-right">
                  <button class="btn" @click="addTask">æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡</button>
                </div>
              </div>
              <div class="form-group-horizontal">
                <label for="taskName">ä»»åŠ¡åç§°</label>
                <div class="form-control-wrapper">
                  <input
                    type="text"
                    id="taskName"
                    class="form-control"
                    v-model="newTask.name"
                    placeholder="æœ€å¤šè¾“å…¥30ä¸ªå­—ç¬¦"
                    maxlength="30"
                  />
                </div>
              </div>
            </div>
          </div>

          <div
            class="task-list module-container task-list-module"
            v-if="currentRole.tasks.length > 0"
          >
            <div class="module-header">
              <div class="module-header-left">
                <h3 class="module-title">ä»»åŠ¡åˆ—è¡¨</h3>
              </div>
              <div class="module-header-right">
                <button class="btn btn-edit" @click="openAddTaskForm">
                  ç¼–è¾‘ä»»åŠ¡
                </button>
              </div>
            </div>
            <div class="task-list-content">
              <div
                v-for="(task, index) in sortedTasks"
                :key="task.id"
                class="task-item"
                :class="{ 'completed': task.completed }"
                @click="toggleTaskStatus(getOriginalIndex(task))"
              >
                <div class="task-content">
                  <input
                    type="checkbox"
                    class="task-checkbox"
                    :checked="task.completed"
                    @click.stop="toggleTaskStatus(getOriginalIndex(task))"
                  />
                  <span class="task-type-tag" :class="task.category"
                    >{{ getCategoryText(task.category) }}</span
                  >
                  <span
                    v-if="!(task.category === 'custom' && task.isEditing)"
                    class="task-name"
                    >{{ task.name }}</span
                  >
                  <input
                    v-else
                    type="text"
                    class="form-control"
                    style="
                      width: auto;
                      min-width: 200px;
                      margin: 0 10px 0 0;
                      display: inline-block;
                    "
                    v-model="task.editName"
                    @keyup.enter="saveInlineEdit(getOriginalIndex(task))"
                    @keyup.esc="cancelInlineEdit(getOriginalIndex(task))"
                    @click.stop
                    ref="inlineEditInput"
                    maxlength="30"
                  />
                </div>
                <div class="task-actions">
                  <template
                    v-if="task.category === 'custom' && !task.isEditing"
                  >
                    <button
                      class="btn btn-edit"
                      @click.stop="startInlineEdit(getOriginalIndex(task))"
                    >
                      ç¼–è¾‘
                    </button>
                  </template>
                  <button
                    v-if="!task.isEditing"
                    class="btn btn-danger"
                    @click.stop="deleteTask(getOriginalIndex(task))"
                  >
                    åˆ é™¤
                  </button>
                  <template v-if="task.isEditing">
                    <button
                      class="btn btn-success"
                      @click.stop="saveInlineEdit(getOriginalIndex(task))"
                    >
                      ä¿å­˜
                    </button>
                    <button
                      class="btn btn-danger"
                      @click.stop="cancelInlineEdit(getOriginalIndex(task))"
                    >
                      å–æ¶ˆ
                    </button>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <div
            v-else-if="!showAddTaskForm"
            class="empty-state module-container"
          >
            <button class="btn btn-edit" @click="openAddTaskForm">
              æ·»åŠ ä»»åŠ¡
            </button>
          </div>
        </div>

        <div class="role-content empty-state module-container" v-else>
          <p>è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²</p>
        </div>
      </div>

      <div class="empty-state module-container" v-else>
        <p>æš‚æ— è§’è‰²ï¼Œè¯·æ·»åŠ æ–°è§’è‰²</p>
      </div>
    </div>

    <script>
      const { createApp, ref, computed, watch, onMounted } = Vue;

      createApp({
        setup() {
          // æ·»åŠ åœ¨ setup å‡½æ•°å¼€å§‹å¤„
          const debounce = (fn, delay) => {
            let timer = null;
            return function (...args) {
              if (timer) clearTimeout(timer);
              timer = setTimeout(() => {
                fn.apply(this, args);
              }, delay);
            };
          };
          
          // æ·»åŠ ç™»å½•ç›¸å…³çš„çŠ¶æ€
          const isLoggedIn = ref(false);
          const token = ref('');
          const showLoginModal = ref(false);
          const loginForm = ref({
            username: '',
            password: ''
          });

          // ç™»å½•æ–¹æ³•
          const login = () => {
            showLoginModal.value = true;
          };

          // å¤„ç†ç™»å½•
          const handleLogin = async () => {
            if (!loginForm.value.username || !loginForm.value.password) {
              alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
              return;
            }

            try {
              const response = await fetch('http://localhost:3000/api/auth/login', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  username: loginForm.value.username,
                  password: loginForm.value.password,
                }),
              });

              const data = await response.json();
              
              if (!response.ok) {
                alert(data.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
                return;
              }

              token.value = data.token;
              isLoggedIn.value = true;
              localStorage.setItem('token', data.token);
              showLoginModal.value = false;
              loginForm.value = { username: '', password: '' };
              
              // ç™»å½•æˆåŠŸåç«‹å³ä»æœåŠ¡å™¨è·å–æ•°æ®
              await loadData();
              // ç™»å½•æˆåŠŸåç«‹å³åŒæ­¥å½“å‰æ•°æ®åˆ°æœåŠ¡å™¨ï¼ˆä¸ä½¿ç”¨é˜²æŠ–ï¼‰
              if (roles.value.length > 0) {
                await fetch('http://localhost:3000/api/data/sync', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token.value}`
                  },
                  body: JSON.stringify({
                    roles: roles.value
                  })
                });
              }
              alert('ç™»å½•æˆåŠŸï¼');
            } catch (error) {
              console.error('ç™»å½•é”™è¯¯:', error);
              alert('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
          };

          // ç™»å‡ºæ–¹æ³•
          const logout = () => {
            token.value = '';
            isLoggedIn.value = false;
            localStorage.removeItem('token');
            // ç™»å‡ºååŠ è½½æœ¬åœ°æ•°æ®
            loadData();
          };

          // æ£€æŸ¥ç™»å½•çŠ¶æ€
          const checkLoginStatus = () => {
            const savedToken = localStorage.getItem('token');
            if (savedToken) {
              token.value = savedToken;
              isLoggedIn.value = true;
            }
          };

          // åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
          onMounted(() => {
            checkLoginStatus();
            loadData();
            checkResetDay();
            // æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦é‡ç½®
            setInterval(checkResetDay, 60 * 60 * 1000);
          });

          // æ•°æ®
          const roles = ref([]);
          const currentRoleIndex = ref(-1);
          const showAddRoleForm = ref(false);
          const showAddTaskForm = ref(false);
          const showEditRoleForm = ref(false);
          const isEditingTask = ref(false);
          const editingTaskIndex = ref(-1);
          const newRole = ref({
            name: "",
            description: "",
            profession: "",
            silver: 0,
          });
          const editingRole = ref({
            name: "",
            description: "",
            profession: "",
            silver: 0,
          });
          const newTask = ref({ name: "" });
          const silverEditValue = ref(0);

          // èŒä¸šåˆ—è¡¨
          const professions = ref([
            { value: "é¬¼ç‹", label: "é¬¼ç‹", class: "ghost-king" },
            { value: "çµæ±", label: "çµæ±", class: "spirit-tide" },
            { value: "é’äº‘", label: "é’äº‘", class: "blue-cloud" },
            { value: "åˆæ¬¢", label: "åˆæ¬¢", class: "harmony" },
            { value: "ç„šé¦™", label: "ç„šé¦™", class: "incense" },
          ]);

          // è·å–èŒä¸šå¯¹åº”çš„CSSç±»
          const getProfessionClass = (profession) => {
            const found = professions.value.find((p) => p.value === profession);
            return found ? found.class : "";
          };

          // é¢„å®šä¹‰ä»»åŠ¡
          const predefinedTasks = ref({
            dungeon: [
              {
                name: "å°æœ¬5è¿",
                size: 5,
                difficulty: "hard",
                displayName: "5äºº",
                selected: false,
              },
              {
                name: "å¤§æœ¬6+1",
                size: 5,
                difficulty: "nightmare",
                displayName: "5äºº",
                selected: false,
              },
              {
                name: "äº‘æ²™é”é»„æ˜",
                size: 10,
                difficulty: "hard",
                displayName: "10äººäº‘æ²™é”é»„æ˜",
                selected: false,
              },
              {
                name: "æ¸¡å„ç‚¼è¡€å ‚",
                size: 10,
                difficulty: "hard",
                displayName: "10äººæ¸¡å„ç‚¼è¡€å ‚",
                selected: false,
              },
              {
                name: "å¹½åŠ«æ­»çµæ¸Š",
                size: 10,
                difficulty: "hard",
                displayName: "10äººå¹½åŠ«æ­»çµæ¸Š",
                selected: false,
              },
              {
                name: "äº‘æ²™é”é»„æ˜",
                size: 20,
                difficulty: "hard",
                displayName: "20äººäº‘æ²™é”é»„æ˜",
                selected: false,
              },
              {
                name: "æ¸¡å„ç‚¼è¡€å ‚",
                size: 20,
                difficulty: "hard",
                displayName: "20äººæ¸¡å„ç‚¼è¡€å ‚",
                selected: false,
              },
              {
                name: "äº‘æ²™é”é»„æ˜",
                size: 10,
                difficulty: "nightmare",
                displayName: "10äººäº‘æ²™é”é»„æ˜",
                selected: false,
              },
              {
                name: "æ¸¡å„ç‚¼è¡€å ‚",
                size: 10,
                difficulty: "nightmare",
                displayName: "10äººæ¸¡å„ç‚¼è¡€å ‚",
                selected: false,
              },
              {
                name: "å¹½åŠ«æ­»çµæ¸Š",
                size: 10,
                difficulty: "nightmare",
                displayName: "10äººå¹½åŠ«æ­»çµæ¸Š",
                selected: false,
              },
            ],
            guild: [
              { name: "å¸®æˆ˜", selected: false },
              { name: "å¸®æ´¾å‘¨å¥–åŠ±", selected: false },
              { name: "å¸®æ´¾é’“é±¼", selected: false },
              { name: "å¸®æ´¾BOSS", selected: false },
            ],
            world: [
              { name: "ä¸–ç•ŒBOSS", selected: false },
              { name: "é‚ªæ­ä»»åŠ¡", selected: false },
              { name: "é£äº‘ä»»åŠ¡", selected: false },
            ],
            other: [
              { name: "é£åå€¼å‘¨å¥–åŠ±", selected: false },
              { name: "åŒ—è’æˆ˜äº‘", selected: false },
              { name: "å‘¨æ´»è·ƒå¥–åŠ±", selected: false },
              { name: "ç’‡ç‘å®åº“", selected: false },
            ],
            vitality: [
              { name: "æ´»åŠ›æ¶ˆè€—", selected: false },
              { name: "é’“é±¼", selected: false },
              { name: "çƒ¹é¥ª", selected: false },
              { name: "ç‚¼è¯", selected: false },
              { name: "é›•åˆ»", selected: false },
              { name: "é”»é€ ", selected: false },
              { name: "ç¼çº«", selected: false },
              { name: "æŒ–çŸ¿", selected: false },
              { name: "é‡‡æ‘˜", selected: false },
            ],
            activity: [
              { name: "æ¤æ ‘èŠ‚æ´»åŠ¨", selected: false },
            ],
          });

          // è®¡ç®—å±æ€§
          const currentRole = computed(() => {
            if (
              currentRoleIndex.value >= 0 &&
              currentRoleIndex.value < roles.value.length
            ) {
              return roles.value[currentRoleIndex.value];
            }
            return null;
          });

          // æ’åºåçš„ä»»åŠ¡åˆ—è¡¨ï¼ˆå·²å®Œæˆçš„ä»»åŠ¡æ”¾åœ¨æœ€åï¼‰
          const sortedTasks = computed(() => {
            if (!currentRole.value || !currentRole.value.tasks) return [];

            // æŒ‰ç…§åˆ†ç±»é¡ºåºæ’åºï¼šå‰¯æœ¬ã€å¸®æ´¾ã€ä¸–ç•Œã€å…¶ä»–ã€æ´»åŠ›ã€è‡ªå®šä¹‰
            const categoryOrder = {
              dungeon: 1,
              guild: 2,
              world: 3,
              other: 4,
              vitality: 5,
              activity: 6,
              custom: 7,
            };

            return [...currentRole.value.tasks].sort((a, b) => {
              // é¦–å…ˆæŒ‰ç…§å®ŒæˆçŠ¶æ€æ’åºï¼ˆæœªå®Œæˆçš„åœ¨å‰ï¼Œå·²å®Œæˆçš„åœ¨åï¼‰
              if (a.completed !== b.completed) {
                return a.completed ? 1 : -1;
              }

              // ç„¶åæŒ‰ç…§åˆ†ç±»é¡ºåºæ’åº
              if (a.category !== b.category) {
                return categoryOrder[a.category] - categoryOrder[b.category];
              }

              // å¦‚æœæ˜¯å‰¯æœ¬ä»»åŠ¡ï¼ŒæŒ‰ç…§äººæ•°å’Œéš¾åº¦æ’åº
              if (a.category === 'dungeon' && b.category === 'dungeon') {
                // é¦–å…ˆæŒ‰äººæ•°æ’åº
                if (a.originalTask.size !== b.originalTask.size) {
                  return a.originalTask.size - b.originalTask.size;
                }
                // äººæ•°ç›¸åŒæ—¶ï¼ŒæŒ‰éš¾åº¦æ’åºï¼ˆå›°éš¾åœ¨å‰ï¼Œå™©æ¢¦åœ¨åï¼‰
                if (a.originalTask.difficulty !== b.originalTask.difficulty) {
                  return a.originalTask.difficulty === 'hard' ? -1 : 1;
                }
                // éš¾åº¦ç›¸åŒæ—¶ï¼ŒæŒ‰åç§°æ’åº
                return a.name.localeCompare(b.name);
              }

              // å…¶ä»–ç±»å‹çš„ä»»åŠ¡æŒ‰åç§°æ’åº
              return a.name.localeCompare(b.name);
            });
          });

          // æŒ‰äººæ•°æ’åºçš„å‰¯æœ¬ä»»åŠ¡
          const sortedDungeonTasks = computed(() => {
            return [...predefinedTasks.value.dungeon].sort((a, b) => {
              // é¦–å…ˆæŒ‰äººæ•°æ’åº
              if (a.size !== b.size) {
                return a.size - b.size;
              }
              // äººæ•°ç›¸åŒæ—¶ï¼ŒæŒ‰éš¾åº¦æ’åºï¼ˆå›°éš¾åœ¨å‰ï¼Œå™©æ¢¦åœ¨åï¼‰
              if (a.difficulty !== b.difficulty) {
                return a.difficulty === "hard" ? -1 : 1;
              }
              // éš¾åº¦ç›¸åŒæ—¶ï¼ŒæŒ‰åç§°æ’åº
              return a.name.localeCompare(b.name);
            });
          });

          // ä¸‹æ¬¡é‡ç½®æ—¥æœŸè®¡ç®—
          const nextResetDate = computed(() => {
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0æ˜¯å‘¨æ—¥ï¼Œ3æ˜¯å‘¨ä¸‰
            const daysUntilWednesday = (3 - dayOfWeek + 7) % 7;
            const nextWednesday = new Date(now);
            nextWednesday.setDate(now.getDate() + daysUntilWednesday);
            nextWednesday.setHours(0, 0, 0, 0);

            return nextWednesday.toLocaleDateString("zh-CN");
          });

          const daysUntilReset = computed(() => {
            const now = new Date();
            const dayOfWeek = now.getDay();
            return (3 - dayOfWeek + 7) % 7 || 7; // å¦‚æœä»Šå¤©æ˜¯å‘¨ä¸‰ï¼Œè¿”å›7
          });

          // è·å–ä»»åŠ¡åœ¨åŸå§‹æ•°ç»„ä¸­çš„ç´¢å¼•
          const getOriginalIndex = (task) => {
            return currentRole.value.tasks.findIndex((t) => t.id === task.id);
          };

          // æ–¹æ³•
          const loadData = async () => {
            if (isLoggedIn.value) {
              try {
                const response = await fetch('http://localhost:3000/api/data/sync', {
                  headers: {
                    'Authorization': `Bearer ${token.value}`
                  }
                });
                const data = await response.json();
                
                if (response.ok) {
                  // æ›´æ–°å†…å­˜ä¸­çš„æ•°æ®
                  roles.value = data.roles || [];
                  
                  localStorage.setItem('roleTaskManager', JSON.stringify(data.roles || []));
                  
                  // æ›´æ–°å½“å‰é€‰ä¸­çš„è§’è‰²
                  if (roles.value.length > 0) {
                    currentRoleIndex.value = 0;
                    silverEditValue.value = roles.value[0].silver || 0;
                  }
                  
                  return;
                }
              } catch (error) {
                console.error('è·å–æœåŠ¡å™¨æ•°æ®å¤±è´¥:', error);
              }
            }
            
            // å¦‚æœæœªç™»å½•æˆ–è·å–æœåŠ¡å™¨æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„æ•°æ®
            const savedRoles = localStorage.getItem('roleTaskManager');
            if (savedRoles) {
              roles.value = JSON.parse(savedRoles);
              if (roles.value.length > 0) {
                currentRoleIndex.value = 0;
                silverEditValue.value = roles.value[0].silver || 0;
              }
            }
          };

          // åˆ›å»ºä¸€ä¸ªé˜²æŠ–çš„åŒæ­¥å‡½æ•°
          const syncDataToServer = debounce(async () => {
            if (isLoggedIn.value) {
              try {
                const response = await fetch('http://localhost:3000/api/data/sync', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token.value}`
                  },
                  body: JSON.stringify({
                    roles: roles.value
                  })
                });
                
                if (!response.ok) {
                  console.error('åŒæ­¥åˆ°æœåŠ¡å™¨å¤±è´¥');
                  if (response.status === 401) {
                    logout();
                    alert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                  }
                }
              } catch (error) {
                console.error('åŒæ­¥æ•°æ®å¤±è´¥:', error);
              }
            }
          }, 2000); // 2ç§’çš„é˜²æŠ–å»¶è¿Ÿ

          // ä¿®æ”¹ saveData å‡½æ•°
          const saveData = () => {
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('roleTaskManager', JSON.stringify(roles.value));
            
            // ä½¿ç”¨é˜²æŠ–çš„åŒæ­¥å‡½æ•°
            syncDataToServer();
          };

          const openAddRoleForm = () => {
            showAddRoleForm.value = true;
            // é‡ç½®newRoleçš„å€¼
            newRole.value = {
              name: "",
              description: "",
              profession: "",
              silver: 0,
            };
          };

          const cancelAddRoleForm = () => {
            showAddRoleForm.value = false;
            // é‡ç½®newRoleçš„å€¼
            newRole.value = {
              name: "",
              description: "",
              profession: "",
              silver: 0,
            };
          };

          const addRole = () => {
            if (!newRole.value.name.trim()) {
              alert("è§’è‰²åç§°ä¸èƒ½ä¸ºç©º");
              return;
            }

            const role = {
              id: Date.now(),
              name: newRole.value.name.trim(),
              description: newRole.value.description || "",
              profession: newRole.value.profession || "",
              silver: 0,
              tasks: [],
            };
            roles.value.push(role);
            currentRoleIndex.value = roles.value.length - 1;
            newRole.value = {
              name: "",
              description: "",
              profession: "",
              silver: 0,
            };
            showAddRoleForm.value = false;
            saveData();
          };

          const selectRole = (index) => {
            currentRoleIndex.value = index;

            // åˆå§‹åŒ–é“¶ä¸¤ç¼–è¾‘å€¼
            if (roles.value[index] && roles.value[index].silver !== undefined) {
              silverEditValue.value = roles.value[index].silver;
            } else {
              silverEditValue.value = 0;
            }

            // åˆ‡æ¢è§’è‰²æ—¶å…³é—­ä»»åŠ¡è¡¨å•
            showAddTaskForm.value = false;
            showEditRoleForm.value = false;
            isEditingTask.value = false;
            editingTaskIndex.value = -1;
            newTask.value = { name: "" };

            // é‡ç½®æ‰€æœ‰é¢„å®šä¹‰ä»»åŠ¡çš„é€‰ä¸­çŠ¶æ€
            Object.keys(predefinedTasks.value).forEach((category) => {
              predefinedTasks.value[category].forEach((task) => {
                task.selected = false;
              });
            });
          };

          const deleteRole = () => {
            if (confirm(`ç¡®å®šè¦åˆ é™¤è§’è‰² "${currentRole.value.name}" å—ï¼Ÿ`)) {
              roles.value.splice(currentRoleIndex.value, 1);
              if (roles.value.length > 0) {
                currentRoleIndex.value = 0;
              } else {
                currentRoleIndex.value = -1;
              }
              saveData();
            }
          };

          const addTask = () => {
            if (!newTask.value.name.trim()) {
              alert("ä»»åŠ¡åç§°ä¸èƒ½ä¸ºç©º");
              return;
            }

            // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œè°ƒç”¨updateTaskæ–¹æ³•
            if (isEditingTask.value && editingTaskIndex.value >= 0) {
              updateTask();
              return;
            }

            const task = {
              id: Date.now(),
              name: newTask.value.name,
              completed: false,
              category: "custom",
              originalTask: { name: newTask.value.name },
            };

            currentRole.value.tasks.push(task);
            newTask.value = { name: "" };
            showAddTaskForm.value = false;
            saveData();
          };

          const openAddTaskForm = () => {
            showAddTaskForm.value = true;
            isEditingTask.value = true; // ä¿®æ”¹ä¸º trueï¼Œè¡¨ç¤ºè¿›å…¥ç¼–è¾‘æ¨¡å¼
            editingTaskIndex.value = -1;
            newTask.value = { name: "", category: "custom" };

            // é‡ç½®æ‰€æœ‰é¢„å®šä¹‰ä»»åŠ¡çš„é€‰ä¸­çŠ¶æ€
            Object.keys(predefinedTasks.value).forEach((category) => {
              predefinedTasks.value[category].forEach((task) => {
                task.selected = false;
              });
            });

            // å¦‚æœå½“å‰è§’è‰²å·²æœ‰ä»»åŠ¡ï¼Œåˆ™åæ˜ ä¹‹å‰é€‰æ‹©çš„é€‰é¡¹
            if (currentRole.value && currentRole.value.tasks.length > 0) {
              // éå†å½“å‰è§’è‰²çš„æ‰€æœ‰ä»»åŠ¡
              currentRole.value.tasks.forEach((roleTask) => {
                // åªå¤„ç†éè‡ªå®šä¹‰ä»»åŠ¡
                if (roleTask.category !== "custom" && roleTask.originalTask) {
                  // æ ¹æ®ä»»åŠ¡ç±»åˆ«æ‰¾åˆ°å¯¹åº”çš„é¢„å®šä¹‰ä»»åŠ¡åˆ—è¡¨
                  const categoryTasks =
                    predefinedTasks.value[roleTask.category];
                  if (categoryTasks) {
                    // å¯¹äºå‰¯æœ¬ä»»åŠ¡ï¼Œéœ€è¦åŒ¹é…åç§°ã€äººæ•°å’Œéš¾åº¦
                    if (roleTask.category === "dungeon") {
                      const matchingTask = categoryTasks.find(
                        (task) =>
                          task.name === roleTask.originalTask.name &&
                          task.size === roleTask.originalTask.size &&
                          task.difficulty === roleTask.originalTask.difficulty
                      );
                      if (matchingTask) {
                        matchingTask.selected = true;
                      }
                    } else {
                      // å¯¹äºå…¶ä»–ç±»å‹ä»»åŠ¡ï¼Œåªéœ€åŒ¹é…åç§°
                      const matchingTask = categoryTasks.find(
                        (task) => task.name === roleTask.originalTask.name
                      );
                      if (matchingTask) {
                        matchingTask.selected = true;
                      }
                    }
                  }
                }
              });
            }
          };

          const cancelTaskForm = () => {
            showAddTaskForm.value = false;
            isEditingTask.value = false;
            editingTaskIndex.value = -1;
            newTask.value = { name: "" };
          };

          const editTask = (taskIndex) => {
            const task = currentRole.value.tasks[taskIndex];

            // å¦‚æœä¸æ˜¯è‡ªå®šä¹‰ä»»åŠ¡ï¼Œåˆ™ä¸å…è®¸ç¼–è¾‘
            if (task.category !== "custom") {
              alert("å›ºå®šä»»åŠ¡ä¸å…è®¸ç¼–è¾‘");
              return;
            }

            // è®¾ç½®ç¼–è¾‘çŠ¶æ€å’Œç´¢å¼•
            isEditingTask.value = true;
            editingTaskIndex.value = taskIndex;
            showAddTaskForm.value = true;

            // å›æ˜¾ä»»åŠ¡åç§°åˆ°è¾“å…¥æ¡†
            newTask.value = {
              name: task.name,
              originalTask: task.originalTask,
              category: task.category,
            };

            // æ»šåŠ¨åˆ°ä»»åŠ¡è¡¨å•åŒºåŸŸ
            setTimeout(() => {
              const taskForm = document.querySelector(".task-form");
              if (taskForm) {
                taskForm.scrollIntoView({ behavior: "smooth" });
              }
            }, 100);
          };

          const updateTask = () => {
            if (!newTask.value.name.trim()) {
              alert("ä»»åŠ¡åç§°ä¸èƒ½ä¸ºç©º");
              return;
            }

            if (
              editingTaskIndex.value >= 0 &&
              editingTaskIndex.value < currentRole.value.tasks.length
            ) {
              // æ›´æ–°ä»»åŠ¡åç§°ï¼Œä½†ä¿ç•™å…¶ä»–å±æ€§
              const task = currentRole.value.tasks[editingTaskIndex.value];
              task.name = newTask.value.name;

              // å¦‚æœæ˜¯è‡ªå®šä¹‰ä»»åŠ¡ï¼ŒåŒæ—¶æ›´æ–°originalTask
              if (task.category === "custom") {
                task.originalTask = { name: newTask.value.name };
              }

              saveData();
              showAddTaskForm.value = false;
              isEditingTask.value = false;
              editingTaskIndex.value = -1;
              newTask.value = { name: "" };
            }
          };

          // æ·»åŠ é€‰ä¸­çš„é¢„å®šä¹‰ä»»åŠ¡
          const addSelectedTasks = () => {
            let hasSelectedTasks = false;

            // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œå…ˆåˆ é™¤å–æ¶ˆå‹¾é€‰çš„å›ºå®šä»»åŠ¡
            if (isEditingTask.value) {
              // åˆ›å»ºä¸€ä¸ªæ˜ å°„ï¼Œè®°å½•å½“å‰é€‰ä¸­çš„å›ºå®šä»»åŠ¡
              const selectedTasksMap = {};

              Object.keys(predefinedTasks.value).forEach((category) => {
                if (category !== "custom") {
                  // åªå¤„ç†å›ºå®šä»»åŠ¡
                  predefinedTasks.value[category].forEach((task) => {
                    if (task.selected) {
                      // å¯¹äºå‰¯æœ¬ä»»åŠ¡ï¼Œä½¿ç”¨åç§°+äººæ•°+éš¾åº¦ä½œä¸ºé”®
                      if (category === "dungeon") {
                        const key = `${category}-${task.name}-${task.size}-${task.difficulty}`;
                        selectedTasksMap[key] = true;
                      } else {
                        // å¯¹äºå…¶ä»–ä»»åŠ¡ï¼Œä½¿ç”¨åˆ†ç±»+åç§°ä½œä¸ºé”®
                        const key = `${category}-${task.name}`;
                        selectedTasksMap[key] = true;
                      }
                    }
                  });
                }
              });

              // è¿‡æ»¤æ‰æœªé€‰ä¸­çš„å›ºå®šä»»åŠ¡
              const filteredTasks = currentRole.value.tasks.filter((task) => {
                // ä¿ç•™æ‰€æœ‰è‡ªå®šä¹‰ä»»åŠ¡
                if (task.category === "custom") {
                  return true;
                }

                // æ£€æŸ¥å›ºå®šä»»åŠ¡æ˜¯å¦åœ¨é€‰ä¸­åˆ—è¡¨ä¸­
                if (task.originalTask) {
                  if (task.category === "dungeon") {
                    const key = `${task.category}-${task.originalTask.name}-${task.originalTask.size}-${task.originalTask.difficulty}`;
                    return selectedTasksMap[key];
                  } else {
                    const key = `${task.category}-${task.originalTask.name}`;
                    return selectedTasksMap[key];
                  }
                }

                return false; // å¦‚æœæ²¡æœ‰originalTaskä¿¡æ¯ï¼Œä¸ä¿ç•™
              });

              // æ˜ç¡®åœ°å°†è¿‡æ»¤åçš„ä»»åŠ¡åˆ—è¡¨èµ‹å€¼ç»™currentRole.value.tasks
              currentRole.value.tasks = filteredTasks;
            }

            // éå†æ‰€æœ‰åˆ†ç±»çš„ä»»åŠ¡
            Object.keys(predefinedTasks.value).forEach((category) => {
              predefinedTasks.value[category].forEach((task) => {
                if (task.selected) {
                  hasSelectedTasks = true;

                  // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²å­˜åœ¨
                  let taskExists = false;
                  if (currentRole.value.tasks) {
                    taskExists = currentRole.value.tasks.some(
                      (existingTask) => {
                        if (
                          existingTask.category === category &&
                          existingTask.originalTask
                        ) {
                          if (category === "dungeon") {
                            return (
                              existingTask.originalTask.name === task.name &&
                              existingTask.originalTask.size === task.size &&
                              existingTask.originalTask.difficulty ===
                                task.difficulty
                            );
                          } else {
                            return existingTask.originalTask.name === task.name;
                          }
                        }
                        return false;
                      }
                    );
                  }

                  // å¦‚æœä»»åŠ¡ä¸å­˜åœ¨ï¼Œæ‰æ·»åŠ 
                  if (!taskExists) {
                    // æ ¹æ®ä»»åŠ¡ç±»å‹æ„å»ºä»»åŠ¡åç§°
                    let taskName = "";
                    if (category === "dungeon") {
                      // å‰¯æœ¬ç±»å‹çš„ä»»åŠ¡ï¼Œä½¿ç”¨æ ¼å¼åŒ–çš„åç§°
                      taskName = `${task.size}äºº${
                        task.name
                      }ï¼ˆ${getDifficultyText(task.difficulty)}ï¼‰`;
                    } else {
                      // å…¶ä»–ç±»å‹çš„ä»»åŠ¡ï¼Œç›´æ¥ä½¿ç”¨åç§°
                      taskName = task.name;
                    }

                    currentRole.value.tasks.push({
                      id: Date.now() + Math.random(),
                      name: taskName,
                      completed: false,
                      category: category,
                      originalTask:
                        category === "dungeon"
                          ? {
                              name: task.name,
                              size: task.size,
                              difficulty: task.difficulty,
                            }
                          : { name: task.name },
                    });
                  }
                  task.selected = false; // é‡ç½®é€‰æ‹©çŠ¶æ€
                }
              });
            });

            if (!hasSelectedTasks && !isEditingTask.value) {
              alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªä»»åŠ¡");
              return;
            }

            showAddTaskForm.value = false;
            isEditingTask.value = false;
            editingTaskIndex.value = -1;
            saveData();
          };

          // å…¨é€‰æŸä¸ªåˆ†ç±»çš„ä»»åŠ¡
          const selectAllInCategory = (category) => {
            const allSelected = predefinedTasks.value[category].every(
              (task) => task.selected
            );

            predefinedTasks.value[category].forEach((task) => {
              task.selected = !allSelected;
            });
          };

          // è·å–å‰¯æœ¬äººæ•°å¯¹åº”çš„æ ·å¼ç±»
          const getSizeClass = (size) => {
            if (size === 5) return "small";
            if (size === 10) return "medium";
            if (size === 20) return "large";
            return "";
          };

          // è·å–å‰¯æœ¬éš¾åº¦å¯¹åº”çš„æ–‡æœ¬
          const getDifficultyText = (difficulty) => {
            if (difficulty === "hard") return "å›°éš¾";
            if (difficulty === "nightmare") return "å™©æ¢¦";
            return "";
          };

          // è·å–ç‰¹å®šäººæ•°çš„å‰¯æœ¬
          const getDungeonsBySize = (size) => {
            return predefinedTasks.value.dungeon
              .filter((task) => task.size === size)
              .sort((a, b) => {
                // å…ˆæŒ‰éš¾åº¦æ’åºï¼ˆå›°éš¾åœ¨å‰ï¼Œå™©æ¢¦åœ¨åï¼‰
                if (a.difficulty !== b.difficulty) {
                  return a.difficulty === "hard" ? -1 : 1;
                }
                // éš¾åº¦ç›¸åŒæ—¶ï¼ŒæŒ‰åç§°æ’åº
                return a.name.localeCompare(b.name);
              });
          };

          const toggleTaskStatus = (taskIndex) => {
            const task = currentRole.value.tasks[taskIndex];
            task.completed = !task.completed;
            saveData();
          };

          const deleteTask = (taskIndex) => {
            currentRole.value.tasks.splice(taskIndex, 1);
            saveData();
          };

          // è¡Œå†…ç¼–è¾‘ç›¸å…³æ–¹æ³•
          const startInlineEdit = (taskIndex) => {
            const task = currentRole.value.tasks[taskIndex];
            if (task.category !== "custom") {
              alert("å›ºå®šä»»åŠ¡ä¸å…è®¸ç¼–è¾‘");
              return;
            }

            // è®¾ç½®ç¼–è¾‘çŠ¶æ€å’Œä¸´æ—¶ç¼–è¾‘åç§°
            task.isEditing = true;
            task.editName = task.name;

            // åœ¨ä¸‹ä¸€ä¸ªDOMæ›´æ–°å‘¨æœŸåèšç„¦è¾“å…¥æ¡†
            setTimeout(() => {
              if (document.querySelector('.task-item input[type="text"]')) {
                document.querySelector('.task-item input[type="text"]').focus();
              }
            }, 50);
          };

          const saveInlineEdit = (taskIndex) => {
            const task = currentRole.value.tasks[taskIndex];

            if (!task.editName || !task.editName.trim()) {
              alert("ä»»åŠ¡åç§°ä¸èƒ½ä¸ºç©º");
              return;
            }

            // æ›´æ–°ä»»åŠ¡åç§°
            task.name = task.editName.trim();

            // å¦‚æœæ˜¯è‡ªå®šä¹‰ä»»åŠ¡ï¼ŒåŒæ—¶æ›´æ–°originalTask
            if (task.category === "custom") {
              task.originalTask = { name: task.name };
            }

            // é€€å‡ºç¼–è¾‘æ¨¡å¼
            task.isEditing = false;
            delete task.editName;

            saveData();
          };

          const cancelInlineEdit = (taskIndex) => {
            const task = currentRole.value.tasks[taskIndex];

            // é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œä¸ä¿å­˜æ›´æ”¹
            task.isEditing = false;
            delete task.editName;
          };

          // è·å–ä»»åŠ¡åˆ†ç±»çš„æ˜¾ç¤ºæ–‡æœ¬
          const getCategoryText = (category) => {
            const categoryMap = {
              custom: "è‡ªå®šä¹‰",
              dungeon: "å‰¯æœ¬",
              guild: "å¸®æ´¾",
              world: "ä¸–ç•Œ",
              other: "å…¶ä»–",
              vitality: "æ´»åŠ›",
              activity: "é™æ—¶",
            };
            return categoryMap[category] || category;
          };

          const calculateProgress = (role) => {
            if (!role || !role.tasks || role.tasks.length === 0) {
              return 0;
            }

            const completedTasks = role.tasks.filter(
              (task) => task.completed
            ).length;
            return Math.round((completedTasks / role.tasks.length) * 100);
          };

          const checkResetDay = () => {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const hours = now.getHours();

            // æ£€æŸ¥æ˜¯å¦æ˜¯å‘¨ä¸‰æ—©ä¸Š8ç‚¹
            if (dayOfWeek === 3 && hours >= 8) {
              const lastResetDate = localStorage.getItem("lastResetDate");
              const today = now.toISOString().split('T')[0];

              // å¦‚æœä»Šå¤©è¿˜æ²¡æœ‰é‡ç½®
              if (lastResetDate !== today) {
                // é‡ç½®æ‰€æœ‰ä»»åŠ¡
                roles.value.forEach((role) => {
                  if (role.tasks) {
                    role.tasks.forEach((task) => {
                      task.completed = false;
                    });
                  }
                });

                // ä¿å­˜é‡ç½®æ—¥æœŸ
                localStorage.setItem("lastResetDate", today);
                saveData();
                console.log("ä»»åŠ¡å·²é‡ç½®");
              }
            }
          };

          const editRole = () => {
            showEditRoleForm.value = true;
            // ä½¿ç”¨æ·±æ‹·è´æ¥é¿å…å¼•ç”¨é—®é¢˜
            editingRole.value = {
              name: currentRole.value.name || "",
              description: currentRole.value.description || "",
              profession: currentRole.value.profession || "",
              silver: currentRole.value.silver || 0,
              tasks: [...(currentRole.value.tasks || [])],
            };
          };

          const saveEditedRole = () => {
            if (!editingRole.value.name.trim()) {
              alert("è§’è‰²åç§°ä¸èƒ½ä¸ºç©º");
              return;
            }

            // åŒæ­¥æ›´æ–° roles æ•°ç»„ä¸­çš„æ•°æ®
            if (
              currentRoleIndex.value >= 0 &&
              currentRoleIndex.value < roles.value.length
            ) {
              roles.value[currentRoleIndex.value] = {
                ...roles.value[currentRoleIndex.value],
                name: editingRole.value.name.trim(),
                description: editingRole.value.description || "",
                profession: editingRole.value.profession || "",
                id: roles.value[currentRoleIndex.value].id,
                tasks: roles.value[currentRoleIndex.value].tasks,
              };

              // ä¿å­˜æ•°æ®å¹¶å…³é—­ç¼–è¾‘è¡¨å•
              saveData();
              showEditRoleForm.value = false;
            }
          };

          const cancelEditRole = () => {
            showEditRoleForm.value = false;
          };

          // æ·»åŠ æ›´æ–°é“¶ä¸¤çš„æ–¹æ³•
          const updateSilver = () => {
            if (currentRole.value) {
              currentRole.value.silver = parseFloat(silverEditValue.value) || 0;
              saveData();
            }
          };

          // å¯¼å‡ºæ•°æ®
          const exportData = () => {
            const data = {
              roles: roles.value,
              lastResetDate: localStorage.getItem("lastResetDate")
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `role-task-manager-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          };

          // å¯¼å…¥æ•°æ®
          const importData = () => {
            const input = document.createElement("input");
            input.type = "file";
            input.accept = ".json";
            input.onchange = (e) => {
              const file = e.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                  try {
                    const data = JSON.parse(e.target.result);
                    if (data.roles && Array.isArray(data.roles)) {
                      roles.value = data.roles;
                      if (data.lastResetDate) {
                        localStorage.setItem("lastResetDate", data.lastResetDate);
                      }
                      currentRoleIndex.value = roles.value.length > 0 ? 0 : -1;
                      saveData();
                      alert("æ•°æ®å¯¼å…¥æˆåŠŸï¼");
                    } else {
                      alert("æ— æ•ˆçš„æ•°æ®æ ¼å¼ï¼");
                    }
                  } catch (error) {
                    console.error("å¯¼å…¥æ•°æ®æ—¶å‡ºé”™ï¼š", error);
                    alert("å¯¼å…¥æ•°æ®æ—¶å‡ºé”™ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼");
                  }
                };
                reader.readAsText(file);
              }
            };
            input.click();
          };

          // ç›‘å¬æ•°æ®å˜åŒ–
          watch(
            roles,
            () => {
              saveData();
            },
            { deep: true }
          );

          // ç¡®ä¿watchç›‘å¬currentRoleå˜åŒ–æ—¶æ›´æ–°é“¶ä¸¤å€¼
          watch(currentRole, (newRole) => {
            if (newRole) {
              silverEditValue.value = newRole.silver || 0;
            }
          });

          // è®¡ç®—æ€»é‡‘é¢
          const calculateTotalSilver = () => {
            return roles.value.reduce(
              (total, role) => total + (role.silver || 0),
              0
            );
          };

          return {
            roles,
            currentRoleIndex,
            currentRole,
            showAddRoleForm,
            showAddTaskForm,
            showEditRoleForm,
            isEditingTask,
            newRole,
            editingRole,
            newTask,
            silverEditValue,
            updateSilver,
            predefinedTasks,
            sortedDungeonTasks,
            sortedTasks,
            nextResetDate,
            daysUntilReset,
            selectRole,
            addRole,
            deleteRole,
            addTask,
            addSelectedTasks,
            selectAllInCategory,
            getSizeClass,
            getDifficultyText,
            getDungeonsBySize,
            toggleTaskStatus,
            deleteTask,
            calculateProgress,
            openAddTaskForm,
            editTask,
            updateTask,
            cancelTaskForm,
            startInlineEdit,
            saveInlineEdit,
            cancelInlineEdit,
            getCategoryText,
            editRole,
            saveEditedRole,
            cancelEditRole,
            getOriginalIndex,
            professions,
            getProfessionClass,
            openAddRoleForm,
            cancelAddRoleForm,
            calculateTotalSilver,
            exportData,
            importData,
            // æ·»åŠ æ–°çš„è¿”å›å€¼
            isLoggedIn,
            login,
            logout,
            showLoginModal,
            loginForm,
            handleLogin,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
